# Read data

Import the data.
Data files are locally stored.

Import Aim 1 Amino Acids and TCA Cycle intermediates (Neg).

```{r}
f <- "../data/raw/Z scores Aim 1 Neg-aa.xlsx"
L1a <- importDataToList(f)
L1a[["file"]]
L1a[["dim"]]
L1a[["names"]]
L1a[["head"]]
D1a <-
  L1a[["data"]] %>%
  mutate(condition = factor(condition, levels = c("wtrest", "wtex", "korest", "koex")))
```

Import Aim 1 Acylcarnitines.

```{r}
f <- "../data/raw/Z scores Aim 1 AC.xlsx"
L1b <- importDataToList(f)
L1b[["file"]]
L1b[["dim"]]
L1b[["names"]]
L1b[["head"]]
D1b <-
  L1b[["data"]] %>%
  mutate(condition = factor(condition, levels = c("wtrest", "wtex", "korest", "koex")))
```

Import Aim 2 Amino Acids and TCA Cycle intermediates (Neg).

```{r}
f <- "../data/raw/Z scores Aim 2 Neg-aa.xlsx"
L2a <- importDataToList(f)
L2a[["file"]]
L2a[["dim"]]
L2a[["names"]]
L2a[["head"]]
D2a <-
  L2a[["data"]] %>%
  mutate(condition = factor(condition, levels = c("wtex", "koc7", "koc8", "koex")))
```

Import Aim 2 Acylcarnitines.

```{r}
f <- "../data/raw/Z scores Aim 2 AC.xlsx"
L2b <- importDataToList(f)
L2b[["file"]]
L2b[["dim"]]
L2b[["names"]]
L2b[["head"]]
D2b <-
  L2b[["data"]] %>%
  mutate(condition = factor(condition, levels = c("wtex", "koc7", "koc8", "koex")))
```


## Exclusions

> From: Benjamin Chan <chanb@ohsu.edu>  
> Date: Wednesday, December 28, 2016 at 11:30 AM  
> To: Melanie Gillingham <gillingm@ohsu.edu>  
> Cc: Garen Gaston <gastong@ohsu.edu>  
> Subject: RE: Gillingham spreadsheets for stats  
> 
> Hi Garen,
>  
> Can you check these data points? The raw values look suspicious to me, like
> they're the "floor" of the detectable range. I'm wondering if they're real or
> if they should be excluded.

```
> D1 %>% filter(value < 1e-6)
# AIM 1
      id genotype activity    chow metabolite_type  metabolite    value  logValue     zValue  zLogValue important
   <chr>   <fctr>   <fctr>  <fctr>          <fctr>      <fctr>    <dbl>     <dbl>      <dbl>      <dbl>     <lgl>
1   1060       KO Exercise Regular     Amino acids     leucine 1.11e-07 -6.954677 -10.830077 -190.02270      TRUE
2   1030       WT Exercise Regular   Organic acids PYRUVIC_P2P 1.11e-07 -6.954677  -1.413972  -13.00909      TRUE
3   1094       WT Exercise Regular   Organic acids PYRUVIC_P2P 1.11e-07 -6.954677  -1.413972  -13.00909      TRUE
4   1134       KO     Rest Regular   Organic acids PYRUVIC_P2P 1.11e-07 -6.954677  -1.413972  -13.00909      TRUE
5 1204B        KO     Rest Regular   Organic acids PYRUVIC_P2P 1.11e-07 -6.954677  -1.413972  -13.00909      TRUE
6 1205B        KO     Rest Regular   Organic acids PYRUVIC_P2P 1.11e-07 -6.954677  -1.413972  -13.00909      TRUE
7   1014       KO Exercise Regular   Organic acids PYRUVIC_P2P 1.11e-07 -6.954677  -1.413972  -13.00909      TRUE
8   1017       KO Exercise Regular   Organic acids PYRUVIC_P2P 1.11e-07 -6.954677  -1.413972  -13.00909      TRUE
9   1019       KO Exercise Regular   Organic acids PYRUVIC_P2P 1.11e-07 -6.954677  -1.413972  -13.00909      TRUE

> D2 %>% filter(value < 1e-6)
# AIM 2
     id genotype activity        chow metabolite_type       metabolite    value  logValue    zValue  zLogValue important
  <chr>   <fctr>   <fctr>      <fctr>          <fctr>           <fctr>    <dbl>     <dbl>     <dbl>      <dbl>     <lgl>
1  1199       WT Exercise  White (C7)   Organic acids 3-HYDROXYBUTYRIC 1.11e-07 -6.954677 -2.516025 -42.518943      TRUE
2  1101       WT Exercise Yellow (C8)   Organic acids           CITRIC 1.11e-07 -6.954677 -2.601795  -3.013728      TRUE
3  1194       WT Exercise  White (C7)   Organic acids           CITRIC 1.11e-07 -6.954677 -2.601795  -3.013728      TRUE
```

### Aim 1

> From: Melanie Gillingham   
> Sent: Wednesday, December 28, 2016 1:15 PM  
> To: Benjamin Chan <chanb@ohsu.edu>  
> Cc: Garen Gaston <gastong@ohsu.edu>  
> Subject: Re: Gillingham spreadsheets for stats  
> 
> Garen and I are going over the min and max for aim 1. We both agree the low
> pyruvic values listed below and the low leucine value are most likely
> undetectable peaks. This could be due to peak misalignment, sample processing,
> or a whole list of other issues and they should probably be deleted.
> 
> The range of log z-scores for the key metabolites in aim 1 is -14 to 9.8 which
> seems to suggest some variability in the data.

```{r}
D1 <- D1 %>% mutate(exclude = value < 1e-6)
message(sprintf("Excluding %d data points", D1 %>% filter(exclude) %>% tally %>% as.integer))
D1 %>% filter(exclude) %>% kable
D1 %>% filter(!exclude) %>% summarize(min(zLogValue), max(zLogValue))
D1 <- D1 %>% filter(!exclude)
```

### Aim 2

> From: Melanie Gillingham   
> Sent: Wednesday, December 28, 2016 11:50 AM  
> To: Benjamin Chan <chanb@ohsu.edu>  
> Cc: Garen Gaston <gastong@ohsu.edu>  
> Subject: Re: Gillingham spreadsheets for stats  
> 
> Garen and I are looking at the min and max right now. Yes, the 1.11e-7 is a
> place holder for below the limit of detection --- or zero. Those values could be
> excluded. We think the 1199 beta hydroxybutyrate is a machine error. The
> fumeric value could also be an error.
> 
> For specific aim 2 the range of the key metabolites for the log z scores looks
> like -9 to 11. That seems like a spread of values around the normal to me.

```{r}
D2 <- D2 %>% mutate(exclude = value < 1e-6 | zLogValue > 20)
message(sprintf("Excluding %d data points", D2 %>% filter(exclude) %>% tally %>% as.integer))
D2 %>% filter(exclude) %>% kable
D2 %>% filter(!exclude) %>% summarize(min(zLogValue), max(zLogValue))
D2 <- D2 %>% filter(!exclude)
```


## Check data

Check the `value` and `zLogValue`.

```{r plotDataAim1, results = "asis", fig.height = 6, fig.width = 10}
kable(summarizeOutcome(D1))
D1 %>%
  ggplot +
  aes(x = zLogValue, y = metabolite, color = activity, fill = activity) +
  geom_jitter(alpha = 1/2) +
  facet_wrap(~ genotype) +
  scale_x_continuous("Normalized log-transformed values") +
  scale_y_discrete("Metabolite") +
  scale_color_brewer("Activity", palette = "Set1") +
  scale_fill_brewer("Activity", palette = "Set1") +
  theme_bw()
ggsave("../figures/plotDataAim1.svg")
```

```{r plotDataAim2, results = "asis", fig.height = 6, fig.width = 10}
kable(summarizeOutcome(D2))
D2 %>%
  ggplot +
  aes(x = zLogValue, y = metabolite, color = chow, fill = chow) +
  geom_jitter(alpha = 1/2) +
  facet_wrap(~ genotype) +
  scale_x_continuous("Normalized log-transformed values") +
  scale_y_discrete("Metabolite") +
  scale_color_brewer("Chow", palette = "Set1") +
  scale_fill_brewer("Chow", palette = "Set1") +
  theme_bw()
ggsave("../figures/plotDataAim2.svg")
```


Check fixed effects factors.

```{r}
D1 %>% group_by(genotype, activity) %>% tally
D1 %>% group_by(genotype, metabolite) %>% tally %>% print(n = nrow(.))
D1 %>% group_by(activity, metabolite) %>% tally %>% print(n = nrow(.))
```

```{r}
D2 %>% group_by(genotype, chow) %>% tally
D2 %>% group_by(genotype, metabolite) %>% tally %>% print(n = nrow(.))
D2 %>% group_by(chow, metabolite) %>% tally %>% print(n = nrow(.))
```
